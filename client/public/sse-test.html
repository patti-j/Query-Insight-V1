<!DOCTYPE html>
<html>
<head><title>SSE Test</title></head>
<body>
<h1>SSE Test</h1>
<button onclick="testEventSource()">Test EventSource (GET)</button>
<button onclick="testFetch()">Test Fetch (POST)</button>
<pre id="output"></pre>
<script>
const output = document.getElementById('output');
function log(msg) { output.textContent += msg + '\n'; }

function testEventSource() {
  log('Testing EventSource (GET)...');
  const es = new EventSource('/api/sse-test');
  es.onopen = () => log('EventSource opened');
  es.onmessage = (e) => log('Message: ' + e.data);
  es.onerror = (e) => { log('Error: ' + JSON.stringify(e)); es.close(); };
}

async function testFetch() {
  log('Testing Fetch (POST)...');
  try {
    const response = await fetch('/api/sse-test', { method: 'POST' });
    log('Response status: ' + response.status);
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let count = 0;
    while (true) {
      const { done, value } = await reader.read();
      count++;
      log('Chunk ' + count + ': done=' + done + ', bytes=' + (value?.length || 0));
      if (value) log('Data: ' + decoder.decode(value));
      if (done) break;
    }
  } catch (e) { log('Error: ' + e.message); }
}
</script>
</body>
</html>
